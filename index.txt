Page({
  data: {
    weekDays: [], // åˆå§‹åŒ–ä¸ºç©ºï¼ŒåŠ¨æ€è®¡ç®—
    weekDayNames: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'],
    dayIndex: 0,
    currentDay: '', // å½“å‰é€‰ä¸­çš„æ˜ŸæœŸ
    currentCourses: [], // å½“å‰æ˜¾ç¤ºçš„è¯¾ç¨‹
    courses: {}, // æ‰€æœ‰è¯¾ç¨‹æ•°æ®
    showAddCourseModal: false,
    newCourse: {},
    weekNumber: 12 // åˆå§‹å€¼ï¼Œåé¢ä¼šåŠ¨æ€è®¡ç®—
  },

  onLoad() {
    // åˆå§‹åŒ–æ—¥æœŸå’Œå‘¨æ•°
    this.initDates();
    this.calculateWeekNumber();
    
    // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½è¯¾ç¨‹
    const savedCourses = wx.getStorageSync('courses');
    if (savedCourses) {
      this.setData({
        courses: savedCourses
      });
    }
    this.updateCurrentCourses();
  },

  onShow() {
    // æ¯æ¬¡æ˜¾ç¤ºé¡µé¢æ—¶æ›´æ–°æ—¥æœŸå’Œè¯¾ç¨‹
    this.initDates();
    this.calculateWeekNumber();
    this.updateCurrentCourses();
  },

  // è®¡ç®—å½“å‰æ˜¯ç¬¬å‡ å‘¨ï¼ˆä»¥2025å¹´12æœˆ23æ—¥ä¸ºç¬¬17å‘¨ä¸ºåŸºå‡†ï¼‰
  calculateWeekNumber() {
    // åŸºå‡†æ—¥æœŸï¼š2025å¹´12æœˆ23æ—¥ï¼ˆå‘¨äºŒï¼‰æ˜¯ç¬¬17å‘¨
    const baseDate = new Date('2025-12-23');
    const baseWeekNumber = 17;
    
    // å½“å‰æ—¥æœŸ
    const now = new Date();
    
    // è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°å·®
    const diffTime = Math.abs(now - baseDate);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    // è®¡ç®—å‘¨æ•°å·®ï¼ˆæ¯7å¤©ä¸º1å‘¨ï¼‰
    const weeksDiff = Math.floor(diffDays / 7);
    
    // è®¡ç®—å½“å‰å‘¨æ•°
    let currentWeekNumber;
    if (now < baseDate) {
      // å¦‚æœå½“å‰æ—¥æœŸåœ¨åŸºå‡†æ—¥æœŸä¹‹å‰
      currentWeekNumber = baseWeekNumber - weeksDiff;
    } else {
      // å¦‚æœå½“å‰æ—¥æœŸåœ¨åŸºå‡†æ—¥æœŸä¹‹å
      currentWeekNumber = baseWeekNumber + weeksDiff;
    }
    
    // ç¡®ä¿å‘¨æ•°ä¸ä¼šä¸º0æˆ–è´Ÿæ•°
    if (currentWeekNumber < 1) {
      currentWeekNumber = 1;
    }
    
    this.setData({
      weekNumber: currentWeekNumber
    });
    
    return currentWeekNumber;
  },

  // åˆå§‹åŒ–æ—¥æœŸæ•°æ®
  initDates() {
    const now = new Date();
    
    // è·å–ä»Šå¤©æ˜¯æ˜ŸæœŸå‡ ï¼ˆ0-6ï¼Œ0æ˜¯å‘¨æ—¥ï¼‰
    const today = now.getDay();
    // è½¬æ¢ä¸ºå‘¨ä¸€ä¸º0çš„ç´¢å¼•
    let todayIndex = today - 1;
    if (todayIndex < 0) todayIndex = 6; // å‘¨æ—¥
    
    // è®¡ç®—ä¸€å‘¨çš„æ—¥æœŸ
    const weekDays = [];
    const daysOfWeek = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
    const dayNames = ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'];
    
    // è·å–ä»Šå¤©çš„æ—¥æœŸ
    const todayDate = new Date(now);
    
    // è®¡ç®—æœ¬å‘¨ä¸€çš„æ—¥æœŸ
    const monday = new Date(todayDate);
    const dayOfWeek = todayDate.getDay();
    const diff = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // å¦‚æœä»Šå¤©æ˜¯å‘¨æ—¥ï¼Œéœ€è¦å‡å»6å¤©
    monday.setDate(todayDate.getDate() - diff);
    
    // ç”Ÿæˆä¸€å‘¨çš„æ—¥æœŸ
    for (let i = 0; i < 7; i++) {
      const currentDay = new Date(monday);
      currentDay.setDate(monday.getDate() + i);
      
      const month = currentDay.getMonth() + 1;
      const date = currentDay.getDate();
      
      weekDays.push({
        name: daysOfWeek[i],
        day: dayNames[i],
        date: `${month < 10 ? '0' + month : month}.${date < 10 ? '0' + date : date}`
      });
    }
    
    // è®¾ç½®å½“å‰é€‰ä¸­çš„æ˜ŸæœŸä¸ºä»Šå¤©
    const currentDay = dayNames[todayIndex];
    
    this.setData({
      weekDays: weekDays,
      currentDay: currentDay,
      dayIndex: todayIndex
    });
  },

  // åˆ‡æ¢æ˜ŸæœŸ
  switchDay(e) {
    const day = e.currentTarget.dataset.day;
    const index = this.data.weekDays.findIndex(item => item.day === day);
    
    this.setData({
      currentDay: day,
      dayIndex: index
    });
    this.updateCurrentCourses();
  },

  // æ›´æ–°å½“å‰æ˜¾ç¤ºçš„è¯¾ç¨‹
  updateCurrentCourses() {
    this.setData({
      currentCourses: this.data.courses[this.data.currentDay] || []
    });
  },

  // æ˜¾ç¤ºæ·»åŠ è¯¾ç¨‹å¼¹çª—
  showAddCourse() {
    // æ‰¾åˆ°å½“å‰æ˜ŸæœŸçš„ç´¢å¼•
    const currentIndex = this.data.weekDays.findIndex(item => item.day === this.data.currentDay);
    
    this.setData({
      showAddCourseModal: true,
      dayIndex: currentIndex,
      newCourse: {
        day: this.data.currentDay,
        name: '',
        time: '08:00-09:40',
        location: ''
      }
    });
  },

  // éšè—æ·»åŠ è¯¾ç¨‹å¼¹çª—
  hideAddCourse() {
    this.setData({
      showAddCourseModal: false
    });
  },

  // é€‰æ‹©æ˜ŸæœŸæ”¹å˜
  onDayChange(e) {
    const index = e.detail.value;
    const selectedDay = this.data.weekDays[index].day;
    
    this.setData({
      dayIndex: index,
      'newCourse.day': selectedDay
    });
  },

  // è¾“å…¥è¯¾ç¨‹ä¿¡æ¯
  onCourseInput(e) {
    const field = e.currentTarget.dataset.field;
    const value = e.detail.value;
    
    this.setData({
      [`newCourse.${field}`]: value
    });
  },

  // æ·»åŠ æ–°è¯¾ç¨‹
  addCourse() {
    const { newCourse, courses } = this.data;
    
    if (!newCourse.name.trim()) {
      wx.showToast({
        title: 'è¯·è¾“å…¥è¯¾ç¨‹åç§°',
        icon: 'none'
      });
      return;
    }

    // ç”Ÿæˆè¯¾ç¨‹ID
    const courseId = Date.now();
    const course = {
      id: courseId,
      name: newCourse.name,
      time: newCourse.time,
      location: newCourse.location || 'å¾…å®š'
    };

    // æ·»åŠ åˆ°å¯¹åº”æ˜ŸæœŸçš„è¯¾ç¨‹åˆ—è¡¨
    const day = newCourse.day;
    const updatedCourses = {
      ...courses,
      [day]: [...(courses[day] || []), course]
    };

    // æ›´æ–°æ•°æ®
    this.setData({
      courses: updatedCourses,
      showAddCourseModal: false
    });

    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    wx.setStorageSync('courses', updatedCourses);
    
    // æ›´æ–°æ˜¾ç¤º
    this.updateCurrentCourses();

    wx.showToast({
      title: 'æ·»åŠ æˆåŠŸ',
      icon: 'success'
    });
  },

  // åˆ é™¤è¯¾ç¨‹
  deleteCourse(e) {
    const courseId = e.currentTarget.dataset.id;
    const day = this.data.currentDay;
    const { courses } = this.data;
    
    wx.showModal({
      title: 'åˆ é™¤è¯¾ç¨‹',
      content: 'ç¡®å®šè¦åˆ é™¤è¿™é—¨è¯¾ç¨‹å—ï¼Ÿ',
      success: (res) => {
        if (res.confirm) {
          const updatedCourses = {
            ...courses,
            [day]: courses[day].filter(course => course.id !== courseId)
          };

          this.setData({
            courses: updatedCourses
          });

          // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
          wx.setStorageSync('courses', updatedCourses);
          
          // æ›´æ–°æ˜¾ç¤º
          this.updateCurrentCourses();

          wx.showToast({
            title: 'åˆ é™¤æˆåŠŸ',
            icon: 'success'
          });
        }
      }
    });
  },

  // è·³è½¬åˆ°ä»»åŠ¡é¡µé¢
  goToTask() {
    wx.switchTab({
      url: '/pages/task/task'
    });
  },

  // è·³è½¬åˆ°AIæ¨èé¡µé¢  
  goToRecommend() {
    wx.switchTab({
      url: '/pages/recommend/recommend'
    });
  }
});




index.json
{
  "usingComponents": {}
}








index.wxml
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <view class="header">
    <text class="title">è¯¾ç¨‹é€š</text>
    <text class="subtitle">ç¬¬{{weekNumber}}å‘¨</text>
  </view>
  
  <!-- å‘¨è§†å›¾ -->
  <view class="week-tabs">
    <view wx:for="{{weekDays}}" wx:key="day" 
          class="tab {{currentDay === item.day ? 'active' : ''}}"
          bindtap="switchDay" data-day="{{item.day}}">
      <text class="tab-day">{{item.name}}</text>
      <text class="tab-date">{{item.date}}</text>
    </view>
  </view>
  
  <!-- è¯¾ç¨‹åˆ—è¡¨ -->
  <view class="course-list">
    <view wx:if="{{currentCourses.length === 0}}" class="no-course">
      <text>ä»Šå¤©æ²¡æœ‰è¯¾ç¨‹</text>
    </view>
    
    <view wx:for="{{currentCourses}}" wx:key="id" class="course-item">
      <view class="course-info">
        <text class="time">{{item.time}}</text>
        <text class="name">{{item.name}}</text>
        <text class="location">{{item.location}}</text>
      </view>
      <view class="course-actions">
        <text class="delete-btn" bindtap="deleteCourse" data-id="{{item.id}}">åˆ é™¤</text>
      </view>
    </view>
  </view>
  
  <!-- æ·»åŠ è¯¾ç¨‹æŒ‰é’® -->
  <view class="add-course-btn" bindtap="showAddCourse">
    <text>â• æ·»åŠ è¯¾ç¨‹</text>
  </view>
  
  <!-- å¿«æ·å…¥å£ -->
  <view class="quick-actions">
    <view class="action" bindtap="goToTask">
      <text class="icon">ğŸ“</text>
      <text class="text">ä»Šæ—¥ä»»åŠ¡</text>
    </view>
    <view class="action" bindtap="goToRecommend">
      <text class="icon">ğŸ¤–</text>
      <text class="text">AIæ¨è</text>
    </view>
  </view>
  
  <!-- æ·»åŠ è¯¾ç¨‹å¼¹çª— -->
  <view wx:if="{{showAddCourseModal}}" class="modal">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ è¯¾ç¨‹</text>
        <text class="close-btn" bindtap="hideAddCourse">Ã—</text>
      </view>
      
      <!-- æ·»åŠ è¿™ä¸ªformæ ‡ç­¾ -->
      <view class="form">
        <!-- é€‰æ‹©æ˜ŸæœŸ -->
        <view class="form-item">
          <text class="label">æ˜ŸæœŸï¼š</text>
          <picker range="{{weekDayNames}}" value="{{dayIndex}}" bindchange="onDayChange">
            <view class="picker">{{weekDays[dayIndex].name}}</view>
          </picker>
        </view>
        
        <!-- è¯¾ç¨‹åç§° -->
        <view class="form-item">
          <text class="label">è¯¾ç¨‹åç§°ï¼š</text>
          <input placeholder="è¯·è¾“å…¥è¯¾ç¨‹åç§°" 
                 value="{{newCourse.name}}" 
                 bindinput="onCourseInput" 
                 data-field="name" />
        </view>
        
        <!-- ä¸Šè¯¾æ—¶é—´ -->
        <view class="form-item">
          <text class="label">ä¸Šè¯¾æ—¶é—´ï¼š</text>
          <input placeholder="ä¾‹å¦‚ï¼š08:00-09:40" 
                 value="{{newCourse.time}}" 
                 bindinput="onCourseInput" 
                 data-field="time" />
        </view>
        
        <!-- ä¸Šè¯¾åœ°ç‚¹ -->
        <view class="form-item">
          <text class="label">ä¸Šè¯¾åœ°ç‚¹ï¼š</text>
          <input placeholder="ä¾‹å¦‚ï¼šA101" 
                 value="{{newCourse.location}}" 
                 bindinput="onCourseInput" 
                 data-field="location" />
        </view>
        
        <button class="submit-btn" bindtap="addCourse">æ·»åŠ è¯¾ç¨‹</button>
      </view> <!-- è¿™ä¸ªformæ ‡ç­¾æ˜¯æ–°å¢çš„ -->
    </view>
  </view>
</view>








index.wxss
/* é¦–é¡µæ ·å¼ - ä¼˜åŒ–ç‰ˆ */
.container {
  padding: 20rpx;
  background-color: #f5f5f5;
  min-height: 100vh;
  box-sizing: border-box;
}

/* é¡¶éƒ¨æ ‡é¢˜ */
.header {
  text-align: center;
  margin-bottom: 30rpx;
  padding: 25rpx 20rpx;
  background: linear-gradient(135deg, #4a90e2, #50c878);
  border-radius: 20rpx;
  color: white;
  box-shadow: 0 4rpx 12rpx rgba(74, 144, 226, 0.3);
}

.title {
  font-size: 44rpx;
  font-weight: bold;
  display: block;
  margin-bottom: 8rpx;
}

.subtitle {
  font-size: 32rpx;
  opacity: 0.95;
}

/* å‘¨è§†å›¾ - ä¼˜åŒ–æ¨ªå‘æ»šåŠ¨ */
.week-scroll {
  width: 100%;
  overflow-x: auto;
  white-space: nowrap;
  margin-bottom: 30rpx;
  padding-bottom: 10rpx;
}

/* å‘¨è§†å›¾æ ·å¼ä¿®æ”¹ */
.week-tabs {
  display: flex;
  background: white;
  border-radius: 15rpx;
  padding: 15rpx 0;
  margin-bottom: 30rpx;
  box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);
  overflow-x: auto;  /* æ·»åŠ æ¨ªå‘æ»šåŠ¨ */
}

.tab {
  flex: 0 0 auto;  /* æ”¹ä¸ºä¸è‡ªåŠ¨ä¼¸ç¼© */
  width: 90rpx;     /* å›ºå®šå®½åº¦ */
  text-align: center;
  padding: 15rpx 5rpx;
}

.tab-day {
  display: block;
  font-size: 24rpx;  /* å‡å°å­—ä½“ */
  margin-bottom: 6rpx;
}

.tab-date {
  display: block;
  font-size: 20rpx;  /* å‡å°å­—ä½“ */
  color: #666;
  margin-bottom: 8rpx;
}

.tab-course {
  display: block;
  font-size: 18rpx;  /* å‡å°å­—ä½“ */
  color: #ff6b6b;
  height: 24rpx;
  overflow: hidden;
}

/* è¯¾ç¨‹åˆ—è¡¨ */
.course-list {
  background: white;
  border-radius: 15rpx;
  padding: 25rpx;
  margin-bottom: 30rpx;
  box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);
}

.course-item {
  padding: 28rpx 0;
  border-bottom: 1rpx solid #f0f0f0;
}

.course-item:last-child {
  border-bottom: none;
  padding-bottom: 0;
}

.time {
  font-size: 26rpx;
  color: #4a90e2;
  font-weight: bold;
  display: block;
  margin-bottom: 12rpx;
}

.name {
  font-size: 32rpx;
  font-weight: bold;
  display: block;
  margin-bottom: 10rpx;
}

.location {
  font-size: 26rpx;
  color: #666;
  display: block;
}

/* å¿«æ·å…¥å£æ ·å¼ - ä¿®æ”¹è¿™éƒ¨åˆ† */
.quick-actions {
  display: flex;
  justify-content: space-between;
  background: white;
  border-radius: 15rpx;
  padding: 25rpx 15rpx;  /* å‡å°‘å·¦å³padding */
  box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);
}

.action {
  flex: 1;
  text-align: center;
  padding: 0 8rpx;  /* å‡å°‘padding */
  min-width: 0;
}

.icon {
  font-size: 40rpx;  /* å‡å°å›¾æ ‡ */
  display: block;
  margin-bottom: 10rpx;
  height: 40rpx;
}

.text {
  font-size: 22rpx;  /* å‡å°å­—ä½“ */
  color: #333;
  display: block;
  white-space: nowrap;
  overflow: visible;  /* æ”¹ä¸ºvisibleï¼Œä¸éšè— */
  text-overflow: clip;
}
/* æ–°å¢æ ·å¼ */
.no-course {
  text-align: center;
  padding: 60rpx 0;
  color: #999;
  font-size: 28rpx;
}

.course-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 25rpx;
  margin-bottom: 20rpx;
  background: white;
  border-radius: 12rpx;
  border-left: 6rpx solid #4a90e2;
}

.course-info {
  flex: 1;
}

.course-actions {
  margin-left: 20rpx;
}

.delete-btn {
  color: #ff6b6b;
  font-size: 24rpx;
  padding: 10rpx 20rpx;
  background: #fff0f0;
  border-radius: 20rpx;
}

.add-course-btn {
  margin: 30rpx 0;
  padding: 25rpx;
  background: #4a90e2;
  color: white;
  text-align: center;
  border-radius: 12rpx;
  font-size: 28rpx;
  font-weight: bold;
}

/* å¼¹çª—æ ·å¼ */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  width: 80%;
  max-width: 600rpx;
  background: white;
  border-radius: 20rpx;
  overflow: hidden;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 30rpx;
  background: #4a90e2;
  color: white;
}

.modal-title {
  font-size: 32rpx;
  font-weight: bold;
}

.close-btn {
  font-size: 40rpx;
  line-height: 1;
}

.form {
  padding: 30rpx;
}

.form-item {
  margin-bottom: 30rpx;
}

.label {
  display: block;
  margin-bottom: 10rpx;
  color: #333;
  font-size: 26rpx;
}

input, .picker {
  width: 100%;
  padding: 20rpx;
  border: 1rpx solid #ddd;
  border-radius: 10rpx;
  font-size: 26rpx;
}

.submit-btn {
  background: #4a90e2;
  color: white;
  margin-top: 20rpx;
  width: 100%;
}